<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D ëª¨ë¸ ë·°ì–´ - ë¶€íŠ¸ìŠ¤íŠ¸ë© í†µí•© ë²„ì „</title>
    
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Three.js ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>

    <style>
        #viewer {
            width: 100%;
            height: 70vh;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .toast-container {
            z-index: 9999;
        }
    </style>
</head>

<body class="bg-light">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">3D Viewer Pro</a>
            <div class="d-flex gap-2">
                <label class="btn btn-outline-light">
                    ğŸ“¦ ëª¨ë¸ ì—…ë¡œë“œ
                    <input type="file" id="modelInput" hidden accept=".obj">
                </label>
                <label class="btn btn-outline-light">
                    ğŸ¨ í…ìŠ¤ì²˜ ì¶”ê°€
                    <input type="file" id="textureInput" hidden accept=".jpg,.png,.jpeg">
                </label>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="container-fluid mt-4">
        <div class="row g-4">
            <!-- 3D ë·°ì–´ ì˜ì—­ -->
            <div class="col-lg-9">
                <div class="card shadow-sm">
                    <div class="card-body p-0">
                        <div id="viewer"></div>
                    </div>
                </div>
            </div>

            <!-- ì •ë³´ íŒ¨ë„ -->
            <div class="col-lg-3">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-primary text-white">
                        ëª¨ë¸ ì •ë³´
                    </div>
                    <div class="card-body">
                        <dl class="row mb-0" id="file-info">
                            <dt class="col-sm-5">íŒŒì¼ í˜•ì‹:</dt>
                            <dd class="col-sm-7" id="file-type">-</dd>
                            
                            <dt class="col-sm-5">í…ìŠ¤ì²˜ ìƒíƒœ:</dt>
                            <dd class="col-sm-7" id="texture-status">ë¯¸ì ìš©</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ ì»¨í…Œì´ë„ˆ -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Three.js êµ¬í˜„ ì½”ë“œ -->
    <script>
        let scene, camera, renderer, controls, currentModel = null;

        // ì´ˆê¸°í™” í•¨ìˆ˜
        function initThreeJS() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / 500, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            
            const viewer = document.getElementById('viewer');
            renderer.setSize(viewer.offsetWidth, viewer.offsetHeight);
            viewer.appendChild(renderer.domElement);

            // ì¡°ëª… ì„¤ì •
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(0, 10, 0);
            scene.add(directionalLight);

            // ì¹´ë©”ë¼ ìœ„ì¹˜
            camera.position.set(0, 2, 5);

            // OrbitControls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            const axesHelper = new THREE.AxesHelper(10); // ê¸¸ì´ 10ì˜ XYZ ì¶• í‘œì‹œ
            scene.add(axesHelper);

            scene.background = new THREE.Color(0xE2E2E2); // í•˜ëŠ˜ìƒ‰
        }

        // íŒŒì¼ ì²˜ë¦¬ ì‹œìŠ¤í…œ
        const handleFileUpload = (type, file) => {
            if (!validateFile(file, type)) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                if(type === 'model') processModel(e.target.result, file.name);
                else applyTexture(e.target.result);
            };
            reader.onerror = (error) => showToast(`íŒŒì¼ ì˜¤ë¥˜: ${error}`, 'danger');
            
            type === 'model' ? reader.readAsText(file) : reader.readAsDataURL(file);
        };

        // ëª¨ë¸ ì²˜ë¦¬
        function processModel(content, filename) {
            try {
                if(currentModel) scene.remove(currentModel);
                
                currentModel = new THREE.OBJLoader().parse(content);
                scene.add(currentModel);
                updateFileInfo('file-type', `OBJ (${filename})`);
                showToast('ëª¨ë¸ ë¡œë“œ ì™„ë£Œ!', 'success');
            } catch (error) {
                showToast('ëª¨ë¸ íŒŒì‹± ì‹¤íŒ¨', 'danger');
            }
        }

        // í…ìŠ¤ì²˜ ì ìš©
        function applyTexture(textureURL) {
            new THREE.TextureLoader().load(textureURL, texture => {
                currentModel.traverse(child => {
                    if (child.isMesh) {
                        child.material.map = texture;
                        child.material.needsUpdate = true;
                    }
                });
                updateFileInfo('texture-status', 'ì ìš© ì™„ë£Œ');
                showToast('í…ìŠ¤ì²˜ ì ìš© ì„±ê³µ!', 'success');
            }, undefined, error => showToast('í…ìŠ¤ì²˜ ì˜¤ë¥˜: ' + error, 'danger'));
        }

        // ìœ íš¨ì„± ê²€ì‚¬
        function validateFile(file, type) {
            const validTypes = {
                model: ['obj'],
                texture: ['jpg', 'jpeg', 'png']
            };
            const ext = file.name.split('.').pop().toLowerCase();
            
            if (!validTypes[type].includes(ext)) {
                showToast(`ì˜ëª»ëœ íŒŒì¼ í˜•ì‹: .${ext}`, 'danger');
                return false;
            }
            return true;
        }

        // UI ì—…ë°ì´íŠ¸
        function updateFileInfo(targetId, value) {
            const element = document.getElementById(targetId);
            element.textContent = value;
            element.classList.add('text-success');
            setTimeout(() => element.classList.remove('text-success'), 1000);
        }

        // í† ìŠ¤íŠ¸ ì•Œë¦¼
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-bg-${type}`;
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>`;
            
            document.querySelector('.toast-container').appendChild(toast);
            new bootstrap.Toast(toast, {autohide: true}).show();
        }

        // ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ëŸ¬
        window.addEventListener('resize', () => {
            const viewer = document.getElementById('viewer');
            camera.aspect = viewer.offsetWidth / viewer.offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(viewer.offsetWidth, viewer.offsetHeight);
        });

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('modelInput').addEventListener('change', e => 
            handleFileUpload('model', e.target.files[0]));
        document.getElementById('textureInput').addEventListener('change', e => 
            handleFileUpload('texture', e.target.files[0]));

        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // ì´ˆê¸°í™” ì‹¤í–‰
        initThreeJS();
        animate();
    </script>
</body>
</html>
